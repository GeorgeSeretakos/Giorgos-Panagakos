generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BookingMode {
  CALENDAR_ONLY
  CONTACT_ONLY
  CALENDAR_AND_CONTACT
  EXTERNAL_REDIRECT
}

model Studio {
  id                     String              @id @default(cuid())
  name                   String
  address                String
  lat                    Float?
  lng                    Float?
  phone                  String?
  email                  String?
  openingHours           Json?
  isActive               Boolean             @default(true)
  createdAt              DateTime            @default(now())
  photoUrls              String[]            @default([])
  slug                   String              @unique
  updatedAt              DateTime            @updatedAt
  services               String[]            @default([])
  availabilityCalendarId String?
  bookingCalendarId      String?
  slotDurationMinutes    Int                 @default(30)
  timezone               String              @default("Europe/Athens")
  iframeSrc              String?
  website                String?
  calendarConnection     CalendarConnection?

  // ── NEW FIELDS ─────────────────────────────────────────
  booking_mode         BookingMode @default(CALENDAR_ONLY)
  external_contact_url String?
  // ───────────────────────────────────────────────────────
}

model CalendarConnection {
  id            String    @id @default(cuid())
  studioId      String    @unique
  calendarId    String?
  accessToken   String?
  refreshToken  String?
  expiry        DateTime?
  grantedScopes String[]  @default([])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  studio        Studio    @relation(fields: [studioId], references: [id])
}

model AppointmentHold {
  id        String   @id @default(cuid())
  studioId  String
  startISO  DateTime
  endISO    DateTime
  expiresAt DateTime
  jti       String   @unique

  @@unique([studioId, startISO, endISO])
  @@index([studioId, startISO, endISO])
}
